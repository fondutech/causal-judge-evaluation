# Multiple Teacher Forcing Passes Analysis

This directory contains analysis of API non-determinism through multiple teacher forcing passes.

## Purpose

We collected 5 independent teacher forcing passes for each prompt-response pair to:
1. Study API non-determinism and its statistical properties
2. Validate the block bootstrap approach
3. Understand variance decomposition (within vs between prompts)

## Key Finding

**99.9% of variance is between prompts, only 0.1% within prompts.**

This validates treating prompts as independent blocks and shows multiple API calls provide minimal statistical benefit.

## Files

- `analyze_variance_decomposition.py` - Canonical analysis script that creates the paper figure
- `multiple_passes_findings.md` - Detailed findings and interpretation

## Usage

This analysis is primarily for validation and won't be run regularly. To reproduce:

```bash
# Ensure you have the multiple pass data in data/logprobs/*_pass*.jsonl
cd analysis/multiple_passes
python analyze_variance_decomposition.py  # Creates the paper figure
```

## Data Requirements

Requires multiple pass files in `../../data/logprobs/`:
- `{policy}_logprobs.jsonl` (pass 1)
- `{policy}_logprobs_pass{2-5}.jsonl` (additional passes)

These files are generated by `data_generation/generate_additional_passes.py`.

## Output

Visualizations are saved to `../../paper_plots/`:
- `variance_decomposition.pdf` - Publication-quality figure
- `variance_decomposition.png` - Preview version